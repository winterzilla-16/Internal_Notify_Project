{% extends "base.html" %}
{% load static %}

{% block title %}Admin Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/buttons.css' %}">
<link rel="stylesheet" href="{% static 'css/admin_dashboard.css' %}">
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}

<div class="admin-dashboard-page">

  <!-- ================= CARD 1: Admin Functional ================= -->
<div class="card dashboard-card shadow-sm mb-4">
  <div class="card-body d-flex align-items-center justify-content-between flex-wrap gap-3">

    <div>
      <h5 class="mb-1">‚ö°ADMIN DASHBOARD‚ö°</h5>
      <p class="text-muted mb-0 small">
        Create And Manage Users Information
      </p>
    </div>  
    <a href="{% url 'admin_create_user' %}"
       class="btn-system btn-green">
        Create User Account üë§
    </a>
  </div>
</div>


<!-- ================= CARD 2: User Notifications ================= -->
<div class="card dashboard-card shadow-sm mb-4">
  <div class="card-body">

    <!-- ===== Header + Pagination ===== -->
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
      <h5 class="mb-0">User Notifications</h5>

      <div class="d-flex align-items-center gap-2">
        {% if notif_page.has_previous %}
          <a class="btn btn-sm btn-outline-secondary"
             href="?notif_page={{ notif_page.previous_page_number }}&user_page={{ user_page.number }}">
            ‚óÄ
          </a>
        {% else %}
          <span class="btn btn-sm btn-outline-secondary disabled">‚óÄ</span>
        {% endif %}

        <span class="small text-muted">
          {% if notif_page_total == 0 %}
            0/0
          {% else %}
            {{ notif_page_num }}/{{ notif_page_total }}
          {% endif %}
        </span>

        {% if notif_page.has_next %}
          <a class="btn btn-sm btn-outline-secondary"
             href="?notif_page={{ notif_page.next_page_number }}&user_page={{ user_page.number }}">
            ‚ñ∂
          </a>
        {% else %}
          <span class="btn btn-sm btn-outline-secondary disabled">‚ñ∂</span>
        {% endif %}
      </div>
    </div>

    <!-- ===== Table ===== -->
    <div class="table-responsive">
      <table class="table table-sm align-middle admin-dashboard-table mb-0">
        <thead class="table-light">
          <tr>
            <th class="truncate text-center">ID</th>
            <th class="truncate text-center">USER</th>
            <th class="truncate text-center">TITLE</th>
            <th class="truncate text-center">TYPE</th>
            <th class="truncate text-center">EVENT TIME</th>
            <th class="truncate text-center">START</th>
            <th class="truncate text-center">INTERVAL VALUE</th>
            <th class="truncate text-center">INTERVAL UNIT</th>
            <th class="truncate text-center">CREATED</th>
          </tr>
        </thead>

        <tbody>
        {% for n in notif_page.object_list %}
          <tr>
            <td class="truncate text-center">{{ n.id }}</td>
            <td class="truncate text-center">{{ n.user_id }}</td>

            <td class="truncate text-center">
              {{ n.title }}
            </td>

            <td>{{ n.event_type }}</td>

            <!-- EVENT DATETIME -->
            <td class="time-cell truncate text-center">
              {% if n.event_datetime %}
                <div class="date-text">{{ n.event_datetime|date:"M j, Y" }}</div>
                <div class="time-text">{{ n.event_datetime|date:"H:i" }}</div>
              {% else %}-{% endif %}
            </td>

            <!-- START DATETIME -->
            <td class="time-cell truncate text-center">
              {% if n.start_datetime %}
                <div class="date-text">
                  {{ n.start_datetime|date:"M j, Y" }}
                </div>
                <div class="time-text">
                  {{ n.start_datetime|date:"H:i" }}
                </div>
              {% else %}
                -
              {% endif %}
            </td>

            <td class="truncate text-center">{{ n.interval_value|default:"-" }}</td>
            <td class="truncate text-center">{{ n.interval_unit|default:"-" }}</td>

            <!-- CREATED -->
            <td class="time-cell truncate text-center">
              <div class="date-text">{{ n.created_at|date:"M j, Y" }}</div>
              <div class="time-text">{{ n.created_at|date:"H:i" }}</div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="9" class="text-center py-4 text-muted">
              ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• notifications
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>




<!-- ================= CARD 3: Users Information ================= -->
<div class="card dashboard-card shadow-sm">
  <div class="card-body">

    <!-- ===== Header + Pagination ===== -->
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
      <h5 class="mb-0">Users Information</h5>

      <div class="d-flex align-items-center gap-2">

        <!-- ‚óÄ Previous -->
        {% if user_page.has_previous %}
          <a class="btn btn-sm btn-outline-secondary"
             href="?user_page={{ user_page.previous_page_number }}&notif_page={{ notif_page.number }}">
            ‚óÄ
          </a>
        {% else %}
          <span class="btn btn-sm btn-outline-secondary disabled">‚óÄ</span>
        {% endif %}

        <!-- Page Info -->
        <span class="small text-muted">
          {% if user_page_total == 0 %}
            0/0
          {% else %}
            {{ user_page_num }}/{{ user_page_total }}
          {% endif %}
        </span>

        <!-- ‚ñ∂ Next -->
        {% if user_page.has_next %}
          <a class="btn btn-sm btn-outline-secondary"
             href="?user_page={{ user_page.next_page_number }}&notif_page={{ notif_page.number }}">
            ‚ñ∂
          </a>
        {% else %}
          <span class="btn btn-sm btn-outline-secondary disabled">‚ñ∂</span>
        {% endif %}

      </div>
    </div>

    <!-- ===== Table ===== -->
    <div class="table-responsive">
      <table class="table table-sm align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th class="truncate text-center">ID</th>
            <th class="truncate text-center">USERNAME</th>
            <th class="truncate text-center">ADMIN</th>
            <th class="truncate text-center">TELEGRAM CHAT ID</th>
            <th class="truncate text-center">DATE JOINED</th>
            <th class="truncate text-center">LAST LOGIN</th>
            <th class="action-col truncate text-center">ACTION</th>
          </tr>
        </thead>

        <tbody>
          {% for u in user_page.object_list %}
            <tr>
              <td class="truncate text-center">{{ u.id }}</td>
              <td class="truncate text-center">{{ u.username }}</td>
              <td class="truncate text-center">{{ u.is_staff }}</td>
              <td class="truncate text-center">{{ u.telegram_chat_id|default:"" }}</td>
              <td class="truncate text-center">{{ u.date_joined }}</td>
              <td class="truncate text-center">{{ u.last_login|default:"" }}</td>

              <td class="action-col">
                <div class="action-icons">
                <!-- Edit (Future Feature) -->
                <a href="{% url 'admin_edit_user' u.id %}"
                   class="btn btn-sm btn-light icon-btn"
                   title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
                  ‚úè
                </a>

                <!-- Delete -->
                <form method="post"
                      action="{% url 'admin_delete_user' u.id %}"
                      onsubmit="return confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡∏•‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');">
                  {% csrf_token %}
                  <button type="submit"
                          class="btn btn-sm btn-light icon-btn"
                          title="‡∏•‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
                    üóë
                  </button>
                </form>
                </div>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="7" class="text-center text-muted py-4">
                ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>


</div>

{% endblock %}
